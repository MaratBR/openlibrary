package templates

import "github.com/MaratBR/openlibrary/internal/app"
import "github.com/MaratBR/openlibrary/internal/i18n"
import "fmt"
import "github.com/MaratBR/openlibrary/internal/olhttp"
import "github.com/eduardolat/goeasyi18n"


templ ProfileBooks(
    user *app.UserDetailsDto,
    result *app.BookSearchResult,
    explainedQuery app.DetailedBookSearchQuery,
) {
    {{
        l := i18n.GetLocalizer(ctx)
        title := l.T("profile.booksOf", goeasyi18n.Options{
            Data: map[string]string{
                "user": user.Name,
            },
        })
    }}

    @standardPageLayout(standardPageLayoutProps{
        htmlLayoutProps: htmlLayoutProps{
            Title: title,
        },
    }) {
        <div class="sticky top-[calc(var(--header-height)+10px)] z-20">
            <nav class="ol-container shadow-md bg-card rounded-full">
                <ul class="tabs tabs--primary-b px-6">
                    <li role="button" class="tab tab--active">
                        <a href={ templ.URL(fmt.Sprintf("/users/%s/books", user.ID)) }>{ l.T("profile.books") }</a>
                    </li>
                    <li role="button" class="tab">
                        <a href={ templ.URL(fmt.Sprintf("/users/%s/collections", user.ID)) }>{ l.T("profile.collections") }</a>
                    </li>
                </ul>
            </nav>
        </div>

        @i18nExtractKeysByPrefix(l, "search")

        <div class="ol-container my-12 px-2" x-data={ fmt.Sprintf("{ openFilters: %t, filtersReady: false }", len(result.Books) == 0) }>
            @SearchResultFragment(result, explainedQuery, true)
        </div>
    }
}

templ ProfileCollections(
    user *app.UserDetailsDto,
    result app.GetUserCollectionsResult,
    booksMap map[int64][]app.CollectionBookDto,
) {
    {{
        l := i18n.GetLocalizer(ctx)
        title := l.T("profile.collectionsOf", goeasyi18n.Options{
            Data: map[string]string{
                "user": user.Name,
            },
        })
    }}

    @standardPageLayout(standardPageLayoutProps{
        htmlLayoutProps: htmlLayoutProps{
            Title: title,
        },
    }) {
        <div class="sticky top-[calc(var(--header-height)+10px)] z-20">
            <nav class="ol-container shadow-md bg-card rounded-full">
                <ul class="tabs tabs--primary-b px-6">
                    <li role="button" class="tab">
                        <a href={ templ.URL(fmt.Sprintf("/users/%s/books", user.ID)) }>{ l.T("profile.books") }</a>
                    </li>
                    <li role="button" class="tab tab--active">
                        <a href={ templ.URL(fmt.Sprintf("/users/%s/collections", user.ID)) }>{ l.T("profile.collections") }</a>
                    </li>
                </ul>
            </nav>
        </div>

        @i18nExtractKeysByPrefix(l, "search")

        <div class="ol-container my-12 px-2">
            if result.TotalPages == 0 {
                @alertInfo() {
                    { l.T("profile.userHasNoCollection") }
                }
            } else {
                {{
                    var pagination templ.Component
                    if result.TotalPages > 0 {
                        pagination = olhttp.Pagination(uint32(result.Page), uint32(result.TotalPages), 9)
                    } else {
                        pagination = templ.NopComponent
                    }
                }}
                @pagination
                @collectionsList(result.Collections, booksMap)
                @pagination
            }
        </div>
    }
}